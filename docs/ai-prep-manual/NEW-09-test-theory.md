# 9章: テスト自動生成

⏱️ **所要時間**: 座学15分

## 📋 この章の目標

- [ ] テストの重要性を理解する
- [ ] AIによるテスト生成の強みを知る
- [ ] 効果的なテスト戦略を学ぶ

---

## 🎯 なぜテストが必要なのか

### テストなしの開発

```
コード書く → 動作確認 → 「動いた！」 → デプロイ
                               ↓
                        数日後バグ発見
                               ↓
                        「あの時は動いたのに...」
```

**問題点**:
- 😱 修正する度に全機能を手動確認
- 🐛 見落としでバグが本番環境に
- ⏰ 動作確認に時間がかかる
- 💸 バグ修正コストが増大

### テストありの開発

```
コード書く → テスト書く → テスト実行 → 全部通過 → 安心してデプロイ
                                           ↓
                                    修正時もテスト実行
                                           ↓
                                    バグを即座に検出
```

**メリット**:
- ✅ 自動で全機能チェック
- ✅ バグを早期発見
- ✅ 安心してリファクタリング
- ✅ ドキュメントとしても機能

---

## 🤖 AIによるテスト生成の強み

### 従来のテスト作成

```
エンジニア: 「テスト書くの面倒...時間ない...」
結果: テストカバレッジ30%以下
```

**問題**:
- テストコード作成に時間がかかる
- テストケースの洗い出しが大変
- モチベーションが上がらない

### AIによるテスト生成

```
エンジニア: 「このコードのテストを書いて」
AI: 「はい、30秒でテストコード生成しました」
結果: テストカバレッジ90%以上
```

**強み**:
- ⚡ 数秒〜数分で生成
- 🎯 網羅的なテストケース
- 📚 テストの書き方も学べる
- 💪 テストを書く習慣がつく

---

## 📝 テストの種類

### 1. ユニットテスト（単体テスト）

**対象**: 関数やメソッド単位

```javascript
// テスト対象
function add(a, b) {
  return a + b;
}

// テストコード
test('add関数: 2つの数値を足す', () => {
  expect(add(2, 3)).toBe(5);
  expect(add(-1, 1)).toBe(0);
  expect(add(0, 0)).toBe(0);
});
```

**メリット**:
- 素早く実行できる
- 問題箇所を特定しやすい
- テストが簡単

### 2. 統合テスト

**対象**: 複数の機能の連携

```javascript
// テスト対象: タスク追加機能全体
test('タスク追加フロー', () => {
  // 1. タスクを入力
  inputTask('買い物');
  // 2. 追加ボタンをクリック
  clickAddButton();
  // 3. 一覧に表示される
  expect(getTaskList()).toContain('買い物');
  // 4. localStorageに保存される
  expect(localStorage.getItem('tasks')).toBeDefined();
});
```

### 3. E2Eテスト（エンドツーエンド）

**対象**: ユーザーの実際の操作フロー

```javascript
// ブラウザを自動操作
test('ユーザーがタスクを完了するまで', async () => {
  await browser.goto('http://localhost:3000');
  await browser.type('#task-input', '買い物');
  await browser.click('#add-button');
  await browser.click('.task-checkbox');
  expect(await browser.text('.task-item')).toHaveStyle('text-decoration: line-through');
});
```

---

## 🎯 効果的なテスト戦略

### テストピラミッド

```
        /\
       /E2E\      少ない（遅い、壊れやすい）
      /------\
     / 統合   \    中くらい
    /----------\
   / ユニット   \  多い（速い、安定）
  /--------------\
```

**原則**:
- ユニットテストを多く書く（70%）
- 統合テストを適度に書く（20%）
- E2Eテストは重要な部分だけ（10%）

### テストケースの洗い出し

**正常系**:
```
✅ 正しい入力 → 期待通りの動作
例: タスク名「買い物」を入力 → 一覧に表示される
```

**異常系**:
```
⚠️ 不正な入力 → エラー処理
例: タスク名を空で入力 → エラーメッセージ表示
```

**境界値**:
```
🎯 境界の値 → 正しく処理される
例:
- 49文字: OK
- 50文字: OK（上限）
- 51文字: エラー
```

### テストの3A原則

```javascript
test('タスク追加', () => {
  // Arrange（準備）
  const taskName = '買い物';

  // Act（実行）
  addTask(taskName);

  // Assert（検証）
  expect(getTaskList()).toContain(taskName);
});
```

---

## 💬 AIへのテスト生成依頼

### パターン1: 関数のテスト

```
💬 「この関数のテストコードを書いてください:

function calculateTotal(expenses) {
  return expenses.reduce((sum, exp) => sum + exp.amount, 0);
}

以下のケースをテストしてください:
- 通常のケース（複数の経費）
- 空の配列
- 1件のみ
- 金額が0の経費を含む」
```

### パターン2: コンポーネントのテスト

```
💬 「タスク追加機能のテストコードを書いてください。

テストケース:
1. 正常追加: タスク名入力 → 追加 → 一覧に表示
2. 空文字エラー: 空で追加 → エラーメッセージ
3. 文字数制限: 51文字 → エラーメッセージ
4. localStorage保存: 追加後にlocalStorageを確認

使用フレームワーク: Jest」
```

### パターン3: E2Eテスト

```
💬 「経費精算アプリのE2Eテストを書いてください。

テストシナリオ:
1. アプリを開く
2. 経費を3件追加
3. カテゴリ別集計を確認
4. 1件削除
5. 集計が更新されることを確認
6. ページをリロード
7. データが保持されることを確認

使用ツール: Playwright」
```

---

## 💼 実務での活用

### ケース1: 副業案件での品質保証

```
状況: 納品後のバグ修正対応が多い

改善:
1. 主要機能にテストを追加
2. 修正のたびにテスト実行
3. バグの混入を防ぐ

効果:
- バグ報告が80%減少
- 修正対応時間が1/3に短縮
- クライアント満足度向上
```

### ケース2: リファクタリングの安心感

```
状況: コードを改善したいが壊れるのが怖い

改善:
1. 現在のコードにテストを追加
2. テストが全部通ることを確認
3. 安心してリファクタリング
4. テストで動作保証

効果:
- 大胆にコード改善できる
- バグを即座に検出
- コード品質向上
```

### ケース3: チーム開発での信頼性

```
状況: 他人のコード変更が怖い

改善:
1. 全機能にテストを用意
2. Pull Request時にテスト実行
3. 全部通過で安心してマージ

効果:
- デグレ（機能劣化）防止
- チーム全体の生産性向上
- レビュー時間短縮
```

---

## 📊 テストカバレッジ

**テストカバレッジ** = テストでカバーされているコードの割合

```
総コード行数: 1000行
テストされている行数: 800行
カバレッジ: 80%
```

### 目安

```
🏆 優秀: 80%以上
✅ 良好: 60-80%
⚠️ 要改善: 40-60%
❌ 不十分: 40%未満
```

### 重要度で優先順位

```
最優先（100%目指す）:
- ビジネスロジック
- セキュリティ関連
- 決済処理

次に重要（80%目指す）:
- CRUD操作
- バリデーション
- データ変換

優先度低（50%でもOK）:
- UI表示ロジック
- ログ出力
- 設定ファイル読み込み
```

---

## ✅ この章のまとめ

- **テストの重要性**: バグ早期発見、安心してリファクタリング
- **AIの強み**: 数秒で生成、網羅的、学習効果
- **テスト戦略**: ピラミッド型、正常系・異常系・境界値
- **実務効果**: バグ減少、品質向上、生産性アップ

---

## 🔗 次のステップ

次は **10章: テストを書く** で、実際にテストコードを生成して実行します！
