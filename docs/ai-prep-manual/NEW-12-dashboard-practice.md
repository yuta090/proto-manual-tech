# 12章: データダッシュボードを作る

⏱️ **所要時間**: 実践60分

## 📋 この章の目標

- [ ] これまでの全スキルを統合して使える
- [ ] 高度なアプリケーションを構築できる
- [ ] データ可視化の実装ができる

---

## 🎯 今回作るもの

**データダッシュボード** - 経費精算データを可視化・分析するアプリ

### 主な機能
- 📊 月次・カテゴリ別グラフ表示
- 📈 トレンド分析
- 🎨 インタラクティブチャート
- 📱 レスポンシブデザイン
- 💾 データインポート/エクスポート

### 使用技術
- Chart.js（グラフライブラリ）
- Bootstrap 5（UIフレームワーク）
- localStorage（データ永続化）

### 使用する全スキル
- ✅ 基本操作（2章）
- ✅ 仕様駆動開発（3-4章）
- ✅ プロンプト設計（5章）
- ✅ 実践開発（6章）
- ✅ コードレビュー（7-8章）
- ✅ テスト自動生成（9-10章）
- ✅ リファクタリング（11章）

---

## 🚀 ハンズオン（60分）

### ステップ1: 仕様書作成（10分）

```bash
mkdir expense-dashboard
cd expense-dashboard
claude
```

まず、今回も仕様駆動で進めます：

```
💬 「経費精算データダッシュボードの仕様書を作成してください。

# 経費精算データダッシュボード

## 概要
経費精算データを可視化・分析するダッシュボードアプリケーション。
月次推移、カテゴリ別分析、統計情報をグラフで表示。

## 機能一覧
1. データインポート
   - CSV/JSONファイルのインポート
   - 6章の経費精算アプリからのデータ移行

2. ダッシュボード表示
   - 月次推移グラフ（折れ線グラフ）
   - カテゴリ別円グラフ
   - 統計サマリー（合計、平均、最大・最小）

3. フィルタリング
   - 期間指定（開始日〜終了日）
   - カテゴリ選択
   - 金額範囲指定

4. データエクスポート
   - グラフ画像のダウンロード
   - フィルタ済みデータのCSV出力

## 画面構成
- ヘッダー: タイトル、期間選択
- サイドバー: フィルタ設定
- メインエリア: グラフ表示エリア
- フッター: 統計サマリー

## 技術要件
- フロントエンド: HTML, CSS, JavaScript
- グラフ: Chart.js
- UI: Bootstrap 5
- データ保存: localStorage

## 非機能要件
- レスポンシブ対応（スマホ・タブレット）
- グラフのアニメーション
- データ更新の即時反映
- 最大1000件のデータを快適に表示

spec.mdとして保存してください。」
```

### ステップ2: プロジェクト構築（15分）

仕様書をもとに実装を依頼：

```
💬 「spec.mdの仕様に基づいて、経費精算データダッシュボードを実装してください。

実装の制約:
1. 1ファイル構成（index.html）
2. Chart.jsはCDN経由で読み込み
3. Bootstrap 5はCDN経由で読み込み
4. サンプルデータを10件程度含める

実装の優先順位:
Phase 1: 基本構造とサンプルデータ表示
Phase 2: グラフ表示（月次推移・カテゴリ別）
Phase 3: フィルタリング機能
Phase 4: インポート/エクスポート機能

まずPhase 1から実装してください。」
```

**確認**:
```bash
open index.html
```

### ステップ3: コードレビューと改善（10分）

**セキュリティ・パフォーマンスチェック**:

```
💬 「実装したコードをレビューしてください。

チェック項目:
1. セキュリティ
   - XSS対策（ユーザー入力のエスケープ）
   - CSVインジェクション対策

2. パフォーマンス
   - 大量データ（1000件）の処理速度
   - グラフ描画の最適化

3. エラーハンドリング
   - ファイル読み込み失敗時
   - 不正なデータ形式時
   - localStorage容量超過時

4. アクセシビリティ
   - キーボード操作対応
   - スクリーンリーダー対応
   - カラーコントラスト

各項目について改善点を指摘し、修正案を提示してください。」
```

**レビュー結果に基づいて改善**:

```
💬 「指摘された問題点をすべて修正してください。
特にパフォーマンスとアクセシビリティを重点的に。」
```

### ステップ4: テスト追加（15分）

**ユニットテストと統合テスト**:

```
💬 「ダッシュボードアプリのテストを作成してください。

テスト環境:
- Jest + jsdom

テストファイル構成:
1. dataProcessing.test.js
   - 月次集計関数のテスト
   - カテゴリ集計関数のテスト
   - フィルタリング関数のテスト

2. chartRendering.test.js
   - グラフデータ生成のテスト
   - オプション設定のテスト

3. dataImportExport.test.js
   - CSVパースのテスト
   - JSONパースのテスト
   - データバリデーションのテスト

4. integration.test.js
   - データインポート → 表示のフロー
   - フィルタ適用 → グラフ更新のフロー
   - エクスポート機能のフロー

各テストで正常系・異常系・境界値をカバーしてください。」
```

**テスト実行**:
```bash
npm test
npm test -- --coverage
```

**カバレッジ目標**: 80%以上

### ステップ5: リファクタリング（10分）

**コード品質向上**:

```
💬 「実装したコードをリファクタリングしてください。

改善ポイント:
1. 関数の分割
   - 100行を超える関数を小さく分割
   - 単一責任の原則に従う

2. 重複コードの削除
   - 共通処理を関数化
   - ユーティリティ関数の作成

3. 命名の改善
   - 変数名を説明的に
   - 関数名を動詞で開始

4. ES6+記法の適用
   - アロー関数
   - 分割代入
   - テンプレート文字列
   - オプショナルチェイニング

5. 定数の整理
   - マジックナンバーを定数化
   - 設定値を一箇所に集約

すべての改善後、テストが通ることを確認してください。」
```

**リファクタリング後のテスト**:
```bash
npm test
```

---

## 📊 完成したアプリの機能

### 1. ダッシュボード画面

```
┌─────────────────────────────────────────────┐
│ 経費精算ダッシュボード    [期間選択] [更新] │
├────────┬────────────────────────────────────┤
│        │  📈 月次推移グラフ                  │
│ フィル │  ┌──────────────────────┐         │
│ ター   │  │折れ線グラフ          │         │
│        │  │（Chart.js）          │         │
│ 📅期間 │  └──────────────────────┘         │
│ 💼カテ │                                    │
│ ゴリー │  📊 カテゴリ別円グラフ              │
│ 💰金額 │  ┌──────────────────────┐         │
│        │  │円グラフ              │         │
│        │  │（Chart.js）          │         │
│        │  └──────────────────────┘         │
├────────┴────────────────────────────────────┤
│ 📊 統計サマリー                              │
│ 合計: ¥1,234,567  平均: ¥12,345  件数: 100 │
└─────────────────────────────────────────────┘
```

### 2. データインポート

```javascript
// CSV形式
日付,カテゴリ,内容,金額
2025-01-15,交通費,タクシー,1500
2025-01-16,食費,会議用弁当,3000

// JSON形式
[
  {
    "date": "2025-01-15",
    "category": "交通費",
    "description": "タクシー",
    "amount": 1500
  }
]
```

### 3. フィルタリング機能

```javascript
// 期間フィルター
startDate: "2025-01-01"
endDate: "2025-01-31"

// カテゴリフィルター
categories: ["交通費", "食費"]

// 金額フィルター
minAmount: 1000
maxAmount: 10000
```

---

## 💡 実装のポイント

### Chart.jsの効果的な使い方

```javascript
// 月次推移グラフ
const lineChart = new Chart(ctx, {
  type: 'line',
  data: {
    labels: ['1月', '2月', '3月'],
    datasets: [{
      label: '月次経費',
      data: [120000, 150000, 130000],
      borderColor: 'rgb(75, 192, 192)',
      tension: 0.1
    }]
  },
  options: {
    responsive: true,
    plugins: {
      title: { display: true, text: '月次推移' }
    }
  }
});

// カテゴリ別円グラフ
const pieChart = new Chart(ctx, {
  type: 'pie',
  data: {
    labels: ['交通費', '食費', '備品'],
    datasets: [{
      data: [45000, 30000, 25000],
      backgroundColor: [
        'rgb(255, 99, 132)',
        'rgb(54, 162, 235)',
        'rgb(255, 205, 86)'
      ]
    }]
  }
});
```

### パフォーマンス最適化

```javascript
// ✅ データ集計の最適化
function aggregateByMonth(expenses) {
  // Map使用で高速化
  const monthlyData = new Map();

  expenses.forEach(exp => {
    const month = exp.date.substring(0, 7); // "2025-01"
    const current = monthlyData.get(month) || 0;
    monthlyData.set(month, current + exp.amount);
  });

  return monthlyData;
}

// ✅ グラフ更新の最適化（デバウンス）
const debouncedUpdateChart = debounce(() => {
  updateChart();
}, 300);

// フィルター変更時
filterInput.addEventListener('input', debouncedUpdateChart);
```

### エラーハンドリング

```javascript
// CSV読み込み
async function importCSV(file) {
  try {
    const text = await file.text();
    const data = parseCSV(text);

    // データ検証
    if (!validateExpenseData(data)) {
      throw new Error('データ形式が不正です');
    }

    return data;
  } catch (error) {
    console.error('CSVインポートエラー:', error);
    showErrorMessage('ファイルの読み込みに失敗しました');
    return null;
  }
}
```

---

## 🎓 学んだスキルの統合

### このプロジェクトで使った技術

**仕様駆動開発（3-4章）**:
- 詳細な仕様書作成
- 段階的な実装（Phase 1-4）

**プロンプト設計（5章）**:
- 具体的な制約条件の指定
- 段階的な依頼
- 検証可能な要件定義

**コードレビュー（7-8章）**:
- セキュリティチェック
- パフォーマンス最適化
- アクセシビリティ対応

**テスト自動生成（9-10章）**:
- ユニットテスト作成
- 統合テスト実装
- カバレッジ80%達成

**リファクタリング（11章）**:
- 関数分割
- 命名改善
- ES6+記法適用

---

## 📈 実務での応用

### ケース1: 社内ダッシュボード開発

```
状況: 営業部門から売上分析ツールの依頼

対応:
1. 仕様書作成（Chart.jsベース）
2. AIで2日で実装完了
3. コードレビューで品質保証
4. テストで動作保証

効果:
- 開発期間: 2週間 → 2日（90%削減）
- バグ発生: ほぼゼロ
- 追加依頼: 他部門からも要望
```

### ケース2: 副業案件での活用

```
状況: クライアントからデータ可視化ツール依頼

対応:
1. 仕様確認・すり合わせ
2. プロトタイプ1日で作成
3. フィードバック反映
4. 納品・保守契約

効果:
- 単価: 20万円/件
- 工数: 3日
- 時給換算: 約8,000円
- リピート率: 80%
```

### ケース3: ポートフォリオ強化

```
状況: 転職活動用のポートフォリオ作成

対応:
1. 複雑なダッシュボード実装
2. テスト・レビュー完備
3. GitHub公開

効果:
- 面接通過率: 60% → 90%
- 「実装力が高い」と評価
- 年収100万円アップでオファー
```

---

## ⚡ さらなる機能拡張

### 次のステップ候補

**初級**:
- 📧 メール通知機能
- 🔔 アラート設定（予算超過など）
- 📱 モバイルアプリ化（PWA）

**中級**:
- 🤖 AIによる異常検知
- 📊 予測分析（来月の経費予測）
- 🔗 会計ソフト連携

**上級**:
- 👥 複数ユーザー対応
- 🌐 リアルタイム同期
- 🔐 権限管理・承認フロー

---

## ✅ この章のまとめ

- **全スキル統合**: 2-11章の全スキルを実践適用
- **高度な実装**: データ可視化・分析アプリの構築
- **品質保証**: レビュー・テスト・リファクタリングの完遂
- **実務レベル**: 副業・転職で使えるポートフォリオ完成

---

## 🎉 完了チェック

この章を終えたら、以下を確認してください：

- [ ] 仕様書からアプリを完成させられた
- [ ] Chart.jsでグラフを実装できた
- [ ] コードレビュー・テスト・リファクタリングを実施できた
- [ ] これまでの全スキルを統合して使えた

**すべてチェックできたら、次は13章で総合実践です！**

---

## 🔗 次のステップ

次は **13章: 総合実践ガイド** で、実務を想定した開発フローの総まとめを行います！
