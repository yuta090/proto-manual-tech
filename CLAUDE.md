# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

> 原則として、このリポジトリに関する回答やドキュメント更新時の説明は日本語で行ってください。

## プロジェクト概要

**⚠️ 重要: ビルドシステムは無効化されています（2025-10-11）**

このプロジェクトは、元々Markdown形式で記述されたドキュメントを、スタイル付きHTMLマニュアルに変換する静的サイトジェネレーターでした。

**現在の運用方針:**
- ビルドスクリプト (`tools/build_manual.py.txt`) は実行不可能な状態です
- `.BUILD_SYSTEM_DISABLED` マーカーファイルが存在します
- **`site/` ディレクトリのHTMLファイルを直接編集してください**
- `docs/` ディレクトリのMarkdownは参照用として保持されています

## プロジェクト構成の理解

### ディレクトリ構造
```
proto-manual-tech/
├── docs/               # Markdownソースファイル（ここを編集）
│   └── ai-prep-manual/ # チャプター別に分割されたMarkdownファイル
├── templates/          # HTMLテンプレート（変更頻度低）
│   ├── manual_template.html   # 個別マニュアルページのテンプレート
│   └── index_template.html    # インデックスページのテンプレート
├── assets/            # CSSやその他のアセット
│   └── manual.css     # スタイル定義（デザインシステム）
├── tools/             # ビルドツール
│   └── build_manual.py # 唯一のビルドスクリプト
└── site/              # 生成されるHTML出力（自動生成、直接編集禁止）
    ├── index.html
    ├── assets/        # assetsディレクトリからコピーされる
    └── [manual-name]/ # マニュアルごとのディレクトリ
```

### アーキテクチャの重要ポイント

**1. ソースと出力の分離**
- `docs/` がソース真実（source of truth）
- `site/` は完全に自動生成される出力
- **絶対に `site/` 内のファイルを直接編集してはいけない** - 再ビルド時に上書きされる

**2. チャプターファイルの命名規則**
- Markdownファイルは `NN-slug.md` 形式で命名（例: `00-sdd.md`, `05-3-ai.md`）
- 先頭の2桁の数字は表示順序を保証する
- この順序を変更すると目次構造に影響する

**3. ビルドパイプライン**
```
Markdown (docs/)
  → MarkdownConverter (Python)
  → HTML fragments
  → Template Application (templates/)
  → Styled HTML (site/)
```

**4. テンプレート変数システム**
テンプレート内の `{{ variable_name }}` プレースホルダーが以下の値で置換される:
- `{{ title }}` - ドキュメントのH1見出しから抽出
- `{{ subtitle_block }}` - H2見出しから生成されるサブタイトル
- `{{ content }}` - 変換されたHTMLコンテンツ
- `{{ toc }}` - 自動生成される目次
- `{{ assets_href }}` - アセットへの相対パス
- `{{ generated_on }}` - 生成日時
- `{{ source_path }}` - ソースファイルパス

## 開発コマンド

### 基本ビルドコマンド
```bash
# 標準ビルド - docs/以下の全マニュアルをsite/に生成
python3 tools/build_manual.py

# カスタム出力先を指定（プレビュー用）
python3 tools/build_manual.py --docs docs --out site-dev

# ビルド後の確認
open site/index.html  # macOS
```

### 開発ワークフロー

**ドキュメント編集時**:
1. `docs/ai-prep-manual/` 内の対応するMarkdownファイルを編集
2. `python3 tools/build_manual.py` を実行
3. `site/index.html` をブラウザで開いて確認
4. 問題があれば1に戻る

**テンプレート変更時**:
1. `templates/manual_template.html` または `index_template.html` を編集
2. 再ビルドして全マニュアルに変更を反映
3. 複数のマニュアルページで表示確認

**CSS変更時**:
1. `assets/manual.css` を編集
2. 再ビルド（assetsディレクトリがsite/にコピーされる）
3. ブラウザでハードリロード（Cmd+Shift+R）して確認

## コーディング規約

### Python（build_manual.py）
- **インデント**: 4スペース（タブ禁止）
- **型ヒント**: 必須（関数シグネチャに型アノテーションを付ける）
- **命名規則**:
  - 関数/変数: `snake_case`
  - クラス: `PascalCase`
  - 定数: `UPPER_CASE`
- **既存パターンの踏襲**: 新しいヘルパー関数を追加する場合は、既存の `format_inlines()` や `build_toc()` のスタイルに合わせる

### Markdown（docs/）
- **見出し構造**: H1（`#`）はタイトル、H2-H6（`##`-`######`）は章・節
- **アンカーの安定性**: 見出しテキストは変更時に注意（URLアンカーが変わる）
- **コードブロック**: 言語指定を推奨（\`\`\`python, \`\`\`bash など）
- **画像**: 外部URLリンクを推奨（ローカルバイナリは避ける）

### HTML/CSS
- **テンプレート**: セマンティックHTML5を使用
- **CSS変数**: `assets/manual.css` の `:root` で定義されたカスタムプロパティを活用
- **レスポンシブ**: 既存のメディアクエリパターンに従う

## MarkdownConverter の動作仕様

`tools/build_manual.py` 内の `MarkdownConverter` クラスは、カスタムMarkdownパーサーです:

**サポートされる構文**:
- 見出し（`#` - `######`）→ `<h1>` - `<h6>` with auto-generated IDs
- 水平線（`---`, `***`, `___`）→ `<hr />`
- リスト（`-`, `*`, `+`, `1.`）→ `<ul>`, `<ol>` with nesting support
- コードブロック（\`\`\`）→ `<pre><code>` with language class
- インライン要素:
  - コード（\`code\`）→ `<code>`
  - リンク（`[text](url)`）→ `<a>` with target="_blank"
  - 画像（`![alt](url)`）→ `<img>` with lazy loading
  - 強調（`**bold**`, `*italic*`）→ `<strong>`, `<em>`

**目次生成**:
- H2見出しがセクション、H3-H4がサブセクションとして階層化
- 各見出しには `slugify()` で生成されたユニークなIDが付与される
- 重複スラッグは自動的に番号サフィックスが追加される

## テスト方針

現時点で自動化されたテストスイートはありません。変更後は以下を手動確認:

**ドキュメント変更時のチェックリスト**:
- [ ] ビルドコマンドがエラーなく完了する
- [ ] 目次リンクが正しく機能する（すべてのアンカーリンクをクリック）
- [ ] コードブロックが正しくハイライトされる
- [ ] 画像が正しく表示される
- [ ] レスポンシブ表示を確認（ブラウザの開発者ツールでモバイル表示）

**ビルドツール変更時のチェックリスト**:
- [ ] 既存の全マニュアルが正常にビルドされる
- [ ] 新しい機能をテストするための一時的なMarkdownファイルを `docs/` に作成
- [ ] 生成されたHTMLを検証ツールで確認
- [ ] テスト用ファイルは削除してからコミット

**テンプレート/CSS変更時のチェックリスト**:
- [ ] 複数のマニュアルページで表示確認
- [ ] ブラウザの開発者ツールでレイアウト崩れがないか確認
- [ ] モバイル/タブレット/デスクトップの各ビューポートで確認

## 編集時の重要な注意事項

### 禁止事項

1. **⛔ ビルドスクリプトを絶対に実行しない（最重要）**
   - `tools/build_manual.py.txt` は完全に無効化されており、**実行してはいけません**
   - `.txt` 拡張子により、誤ってPythonとして実行することもできません
   - **いかなる理由があっても、ビルドスクリプトを実行・復元・リネームしてはいけません**
   - ビルド実行により `site/` 内のHTML手動編集（グラスモーフィズムデザイン）がすべて失われます

2. **✅ `site/` ディレクトリのHTMLファイルを直接編集する（推奨）**
   - ビルドシステムが無効化されているため、HTML直接編集が安全です
   - 変更内容は保持され、上書きされることはありません

3. **`site/` ディレクトリ内のファイルやディレクトリを削除しない（重要）**
   - `rm -rf site/xxx/` などの削除コマンドは絶対に実行禁止
   - ユーザーがブックマークしているURLを壊さないため
   - 削除が必要な場合は必ずユーザーに確認すること

4. **チャプターファイルの順序番号を安易に変更しない**
   - 既存のアンカーリンクやブックマークが壊れる可能性があります
   - 必要な場合は、影響範囲を確認してから変更

5. **テンプレート変数名を変更しない**
   - `{{ title }}` などの変数名は `build_manual.py` と密接に連携しています
   - 変更する場合は、Pythonコードとテンプレートの両方を同期して更新

### ベストプラクティス

**新しいマニュアルを追加する場合**:
1. `docs/` 内に新しいディレクトリまたはMarkdownファイルを作成
2. チャプターが複数ある場合は、`NN-slug.md` 形式で命名
3. H1見出しでタイトルを定義
4. ビルドして `site/index.html` で新しいマニュアルが表示されることを確認

**既存のコンバーター機能を拡張する場合**:
1. 新しいMarkdown構文をサポートする前に、`docs/` にテストケースを作成
2. `MarkdownConverter.convert()` メソッドを段階的に拡張
3. 既存の変換ロジックを破壊しないように注意（リグレッション確認）
4. 型ヒントとdocstringを追加

**CSSデザインシステムの変更**:
- CSS変数（`:root` 内のカスタムプロパティ）を活用して一貫性を保つ
- 新しいスタイルを追加する場合、既存のクラス命名規則に従う（BEM風）
- レスポンシブデザインを考慮（既存のメディアクエリブレークポイントを確認）

## Git ワークフロー

**コミットメッセージ規約**:
```
[type]: [scope-aware summary]

[optional description]

Examples:
refactor: tighten TOC link formatting
docs: update chapter 5 with MCP examples
fix: correct nested list indentation in converter
feat: add support for blockquote syntax
```

**プルリクエスト時**:
- 影響を受けるマニュアルをリスト化
- ビルドコマンドの出力結果を記載
- HTMLレイアウトが変更された場合はスクリーンショットを添付
- 関連するIssue番号やタスク参照をリンク
- フォローアップ作業（未完成の章やCSS改善）があれば明記

## トラブルシューティング

**ビルドエラーが発生する場合**:
1. Python 3.8以上がインストールされているか確認
2. `docs/` ディレクトリとテンプレートファイルが存在するか確認
3. MarkdownファイルのエンコーディングがUTF-8か確認
4. エラーメッセージのトレースバックを確認し、問題のあるMarkdownファイルを特定

**目次リンクが機能しない場合**:
- 見出しテキストに特殊文字が含まれている可能性（`slugify()` 関数の動作確認）
- 同じ見出しテキストが複数ある場合の番号サフィックス確認
- ブラウザの開発者ツールでアンカーIDを検証

**CSSが反映されない場合**:
- `assets/` ディレクトリが `site/assets/` に正しくコピーされているか確認
- ブラウザのキャッシュをクリア（ハードリロード）
- 相対パス `{{ assets_href }}` が正しく設定されているか確認

## 参考リンク

このプロジェクトに関する詳細情報:
- **AGENTS.md**: 基本的なプロジェクト構造とビルドコマンド
- **docs/ai-prep-manual/**: AIツール活用マニュアルのソースファイル
- **templates/**: HTMLテンプレートの実装例
